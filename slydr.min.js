"use strict";export class Slydr{constructor(t,e){var s,i,a,r,n,l,o,d=this,h=!1,f=(t=>{let e=Object.assign({"start-at":0,image:"",height:40,width:100,unit:"%","color-shift":!1,disabled:!1,vertical:!1,"no-handle":!1,buttons:!1,retina:!1,"custom-range":[0,0],"key-control":!1,flag:!1},t);return e.snap=Object.assign({marks:!1,type:!1,points:0,sensitivity:2},t.snap),e})(e);let c=0,p=null,u=null,y=null;const g={},v=f.vertical,m=f.snap.points>1&&f.snap.points<=11,w=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),b=Math.round(f.snap.points),x=("hard"==f.snap.type||"soft"==f.snap.type)&&f.snap.type,k=f["color-shift"],L=m&&f.snap.marks,M=new Event("makeready."+Slydr.entries.length),S=f["custom-range"],W=(0!==S[0]||0!==S[1])&&S[0]<S[1],E=1==f["key-control"],V="ctrl"===f["key-control"],A="shift"===f["key-control"];if(this.is={get disabled(){return f.disabled}},this.get={data:{get value(){return n},get"init-value"(){return f["start-at"]}},get"user-callbacks"(){return g},get elements(){return{knob:a,trak:i,frame:s,container:t,flag:r}}},W){const t=S[0],e=S[1]-t;Object.defineProperty(this.get.data,"unit",{get:()=>e*n/100+t})}const P=t=>{t&&this.destroy(!0),T(),C.init(),$(),K(f.image&&!f["no-handle"]),z(),s.addEventListener("makeready."+Slydr.entries.length,()=>{m&&(H.setValues(),setTimeout(()=>H.pre(),0)),v&&_(),f.buttons&&N.draw(),k&&j(),this.position=n=f["start-at"]||50,f.flag&&C.flag(),g.ready&&g.ready()}),t||Slydr.entries.push(this)},C={init(){s=Slydr.create("slydr",t),i=Slydr.create("trak",s),a=Slydr.create("knob",s),s.style.width=f.width+f.unit,s.style.height=f.height+"px",t.classList.add("slydr-container")},flag(){r=Slydr.create("slydr-flag",t,"span"),d.flag(f.vertical)}},T=()=>{if(!(t instanceof Element))throw new Error("Slydr: first param expected Element, found "+typeof t);if(!(e instanceof Object))throw new Error("Slydr: second param expected Object, found "+typeof e)},j=()=>{Slydr.create("",i).style.opacity=String(f["start-at"]/100)},D=t=>i.children[0].style.opacity=t/100,K=t=>{if(t){let t=f.image;const r=window.devicePixelRatio>1&&f.retina;if(r){const e=t.lastIndexOf(".");t=t.slice(0,e)+"@2x"+t.slice(e)}let n=new Image;function e(){r&&(n.style.width=n.offsetWidth/2+"px");var e=n.offsetHeight,l=n.offsetWidth+"px",o=e+"px",d=`url(${t}) no-repeat`;if(a.style.width=l,a.style.height=o,setTimeout(()=>{a.style.background=d,r&&(a.style.backgroundSize="100%")},0),i.style.height=o,s.style.height=o,a.removeChild(n),e>f.height){var h=(e-f.height)/2;s.style.height=f.height+"px",s.style.overflow="visible",a.style.top=`-${h}px`,i.style.height=f.height+"px"}s.dispatchEvent(M)}n.onload=e,n.src=t,a.appendChild(n)}else{f.height;s.style.overflow="hidden",setTimeout(()=>{s.dispatchEvent(M)},0)}},_=()=>{if(L){let t=[s,p];y=Slydr.create("vertical-marks"),Slydr.wrapAll(t,y)}s.classList.add("vertical")},z=()=>{if(!w&&(E||A||V)&&!f.disabled){let t,e=!1,s=!1,i=!1,a=v?40:37,r=v?38:39;R.docKeyDown=(n=>{e||(window.event?(t=window.event.keyCode,s=window.event.shiftKey,i=window.event.ctrlKey):n&&(t=n.which,s=n.shiftKey,i=n.ctrlKey),(A&&s&&!i||V&&i&&!s||!A&&!V)&&(t===a?(N.eventMouseDown("<"),e=!0):t===r&&(N.eventMouseDown(">"),e=!0)))}),R.docKeyUp=(()=>{e=!1,N.clearAction()}),document.addEventListener("keydown",R.docKeyDown),document.addEventListener("keyup",R.docKeyUp)}},B={down:w?"touchstart":"mousedown",move:w?"touchmove":"mousemove",up:w?"touchend":"mouseup"},R={barMouseDown(e){if(e.returnValue&&(e.returnValue=!1),h=!0,s.dataset.state="active",t.classList.add("slydr-active"),!w){const t=s.offsetWidth,l=a.offsetWidth;var r=R.cursorRegistration(e);let o=r-l/2;o<0?(o=0,a.style.left="0"):o>=t-l&&(o=t-l,a.style.left=t-l+"px"),a.style.left=o+"px",i.style.width=o+l/2+"px",x&&"hard"!==x||(n=d.getPercent("hard"===x?H.init("drag",o):o)),k&&D(n),f.flag&&d.flag(f.vertical)}},docMouseMove(t){if(h){const l=s.offsetWidth,o=a.offsetWidth;var e=R.cursorRegistration(t);const h=o/2,p=e-h;t.returnValue&&(t.returnValue=!1),e<=h&&(!m||"hard"!==x)?(a.style.left="0",i.style.width=h+"px"):e>=l-h&&(!m||"hard"!==x)?(a.style.left=l-o+"px",i.style.width=l-h+"px"):(a.style.left=e-h+"px",i.style.width=e+"px",x&&"hard"!==x||H.init("drag",p)),c=a.offsetLeft;var r=s.dataset.state;n=d.getPercent(c),f.flag&&d.flag(f.vertical),g.drag&&g.drag(d.get.data),k&&"active"===r&&D(n)}},docMouseUp(){if(h=!1,"active"===s.dataset.state){const e=a.offsetLeft;c=!m||"soft"!==x&&"hard"!==x?e<0?0:e:H.init("drop",e),n=d.getPercent(c),g.drop&&g.drop(d.get.data),s.dataset.state="inactive",t.classList.remove("slydr-active"),k&&D(n),f.flag&&d.flag(f.vertical)}N.is_down&&N.clearAction()},winResize(){const t=a.offsetWidth,e=s.offsetWidth;if(d["start-at"]=n,L){let s=null;p.style.width=e+"px";let i=[].slice.call(p.children);i.forEach((i,a)=>{s=(e-t)/(b-1)*a+t/2,i.style.left=s+"px"})}},cursorRegistration(t){const e=s.getBoundingClientRect();if(v){let i=e.top+s.offsetWidth;return Math.floor(i-(w?t.targetTouches[0].pageY:t.pageY))}return Math.floor((w?t.targetTouches[0].pageX:t.pageX)-e.left)}},$=()=>{f.disabled||(s.addEventListener(B.down,R.barMouseDown),document.addEventListener(B.move,R.docMouseMove),document.addEventListener(B.up,R.docMouseUp),window.addEventListener("resize",R.winResize))},H={pctValues:[0],storedValue:"s-1",index:null,init(t,e){if(m){var r=f.snap.sensitivity;if(r||"hard"===x||"soft"===x){var n=a.offsetWidth,l=s.offsetWidth,o=(r&&r>0&&r<4?5*(r+1):15)-3;let d=[];for(let t of this.pctValues)d.push((l-n)*t/100);let h=null,f=0,c=0;for(let t of d)(null===h||Math.abs(t-e)<Math.abs(h-e))&&(h=t,f=this.pctValues[c],this.index=c),c++;return"drag"===t?"hard"===x?(a.style.left=h+"px",i.style.width=h+n/2+"px",this.on(h,f)):Math.round(Math.abs(h-e))<o?(a.style.left=h+"px",i.style.width=h+n/2+"px",this.on(h,f)):this.storedValue="s-1":(a.style.left=h+"px",i.style.width=h+n/2+"px"),h}}},setValues(){for(var t=a.offsetWidth,e=100/(b-1),s=e;s<=101;)this.pctValues.push(s),s+=e;L&&this.drawMarks(t)},drawMarks(t){var e=s.offsetWidth;if(s.insertAdjacentHTML("afterend",'<div class="slydr-markers"></div>'),p=s.parentNode.getElementsByClassName("slydr-markers")[0],p.style.width=e+"px",p){let s="",i=null;p.style.width=e+"px";for(let a=b-1;a>=0;a--)i=(e-t)/(b-1)*a+t/2,s+=`<div style="left:${i}px"></div>`;p.innerHTML=s}},on(t){"s"+t!==this.storedValue&&(this.storedValue="s"+t,n=d.getPercent(t),g.snap&&g.snap(d.get.data))},pre(){switch(x){case"hard":case"soft":this.init("drag",a.offsetLeft),n=d.getPercent(a.offsetLeft)}}},N={knob_adjust:0,is_down:!1,timers:null,snap:m&&("hard"===x||"soft"===x),draw(){if(this.knob_adjust=a.offsetWidth/s.offsetWidth*50,l=Slydr.create("slydr-buttons"),o=Slydr.create("slydr-buttons"),l.innerHTML="&nbsp;+&nbsp;",o.innerHTML="&nbsp;&minus;&nbsp;",o.style["font-size"]=l.style["font-size"]=s.offsetHeight+"px",L){let t=null;if(v)t=s.closest(".vertical-marks");else{s.style.width=`${p.offsetWidth}px`;let e=[s];u=Slydr.create("button-marks"),L&&e.push(p),t=Slydr.wrapAll(e,u)}t.insertBefore(l,s.nextSibling),t.prepend(o)}else s.style.display=v?"block":"inline-block",s.style.verticalAlign="middle",s.parentNode.insertBefore(l,s.nextSibling),s.parentNode.insertBefore(o,s);f.disabled||(l.addEventListener(B.down,()=>this.eventMouseDown(">")),l.addEventListener(B.up,this.clearAction),o.addEventListener(B.down,()=>this.eventMouseDown("<")),o.addEventListener(B.up,this.clearAction))},triggers(t,e){if(this.snap){if(null===H.index)for(let e=0;e<H.pctValues.length;e++)if(H.pctValues[e]>=n){H.index=">"===t?e-1:e;break}">"===t?b-1>H.index&&H.index++:H.index>0&&H.index--,n=H.pctValues[H.index]}else">"===t?n+=e?1:10:n-=e?1:10;var r=n;n+this.knob_adjust>100?(n=100,r=100):n-this.knob_adjust<0&&(n=0,r=0);var l=(s.offsetWidth-a.offsetWidth)*r/100+a.offsetWidth/2,o=l-a.offsetWidth/2;a.style.left=o+"px",i.style.width=l+"px",k&&D(r),n=d.getPercent(o),f.flag&&d.flag(f.vertical),g["button-press"]&&g["button-press"](d.get.data)},hold(t){var e=setInterval(()=>{this.is_down?this.triggers(t,!0):clearInterval(e)},this.snap?101:10)},clearAction(){this.is_down=!1,clearTimeout(this.timers)},eventMouseDown(t){this.is_down=!0,this.triggers(t),this.timers=setTimeout(()=>this.hold(t),500)}};this.reset=(()=>P(!0)),P()}getPercent(t){var e=t/(this.get.elements.frame.offsetWidth-this.get.elements.knob.offsetWidth)*100;return Math.min(e,100)}on(t,e){switch(t){case"ready":case"drop":case"drag":case"snap":case"button-press":this.get["user-callbacks"][t]=(t=>e.call(this,t));break;default:console.warn('Slydr: "'+t+"\" isn't an accepted event name. See documentation.")}return this}destroy(t){const e=this.get.elements.container;for(;e.firstChild;)e.removeChild(e.firstChild);if(e.classList.remove("slydr-container"),!t){for(let t in this)delete this[t];Slydr.entries.forEach((t,e)=>{t===this&&Slydr.entries.splice(e,1)})}}flag(t){const e=this.get.data,s=this.get.elements;s.flag.textContent=`${Math.round(e.value)}%`,t&&!s.flag.classList.contains("vertical")?s.flag.classList.add("vertical"):t||s.flag.classList.remove("vertical"),s.flag.style.transform=t?`translateY(${s.frame.offsetWidth-s.knob.offsetLeft}px)`:`translateX(${-1*s.frame.offsetWidth+s.knob.offsetLeft}px)`}set position(t){const e=this.get.elements,s=this.get.elements.frame.offsetWidth,i=e.knob.offsetWidth;t<=0?t=0:t>=100&&(t=100);const a=(s-i)*t/100+i/2,r=a-i/2;e.knob.style.left=r+"px",e.trak.style.width=a+"px",this.is.colorShift&&(e.trak.children[0].style.opacity=t/100)}static wrapAll(t,e){t[0].parentNode.insertBefore(e,t[0]);for(let s of t)e.appendChild(s);return e}static create(t,e,s){var i=document.createElement(s||"div");return i.className=t,e&&e.appendChild(i),i}static get info(){return{author:"Daniel B. Kazmer (webshifted.com)",created:"2019-11-23",modified:"2020-05-02",version:"1.0.0 beta",github:"https://github.com/dkazmer/slydr","home-page":"https://webshifted.com/slydr"}}}Slydr.entries=[];