/*
 * Slydr v1.0.0 beta
 * by Daniel B. Kazmer
 * https://webshifted/slydr
 */
"use strict";class Slydr{constructor(e,t){this.container=e;var s,n,i,o,r,l,a=this,d=!1,h=(e=>{let t=Object.assign({"start-at":0,image:"",height:40,width:100,unit:"%",pill:!0,"color-shift":[],disabled:!1,vertical:!1,"no-handle":!1,buttons:!1,retina:!1,"custom-range":[0,0],"key-control":!1},e);return t.snap=Object.assign({marks:!1,type:!1,points:0,sensitivity:2},e.snap),t.events=Object.assign({},e.events),t})(t);let c=0,f=null,u=null,p=null,y=null,v=null;const m=h.vertical,g=h.snap.points>1&&h.snap.points<=11,w=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),x=Math.round(h.snap.points),b=("hard"==h.snap.type||"soft"==h.snap.type)&&h.snap.type,k=h["color-shift"].length>1,E=g&&h.snap.marks,L=new Event("makeready."+Slydr.entries.length),M=(0!==h["custom-range"][0]||0!==h["custom-range"][1])&&h["custom-range"][0]<h["custom-range"][1],S=1==h["key-control"],W="ctrl"===h["key-control"],C="shift"===h["key-control"];if(this.is={get colorShift(){return k}},this.data={get percent(){return o}},M){const e=h["custom-range"][0],t=h["custom-range"][1]-e;Object.defineProperty(this.data,"custom-unit",{get:()=>t*o/100+e})}const V=e=>{e&&this.destroy(!0),D(),T(),z(),N(h.image&&!h["no-handle"]),B(),s.addEventListener("makeready."+Slydr.entries.length,()=>{g&&(H.setValues(),setTimeout(()=>H.pre(),0)),m&&j(),h.buttons&&O.draw(),k&&A(),this.position=o=h["start-at"]||50,v instanceof Function&&v.call(this,this.data),delete this.ready}),e||Slydr.entries.push(this)},T=()=>{if(s=this.frameElement=Slydr.create("slydr",e),n=this.trak=Slydr.create("trak",s),i=this.knob=Slydr.create("knob",s),s.style.width=h.width+h.unit,s.style.height=h.height+"px",h.pill){let e=s.offsetHeight/2;s.style["border-radius"]=e+"px",n.style["border-radius"]=e+"px 0 0 "+e+"px"}},D=()=>{if(!(e instanceof Element))throw new Error("Slydr: first param expected Element, found "+typeof e);if(!(t instanceof Object))throw new Error("Slydr: second param expected Object, found "+typeof t)},A=()=>{n.style.overflow="hidden",n.style.backgroundColor=h["color-shift"][0],n.innerHTML=`<div style="opacity:${h["start-at"]/100}; height:100%; background-color:${h["color-shift"][1]};"></div>`},P=e=>n.children[0].style.opacity=e/100,N=e=>{var t=h.pill;if(e){let e=h.image;const o=window.devicePixelRatio>1&&h.retina;if(o){const t=e.lastIndexOf(".");e=e.slice(0,t)+"@2x"+e.slice(t)}let r=new Image;r.onload=function(){o&&(r.style.width=r.offsetWidth/2+"px");var l=r.offsetHeight,a=r.offsetWidth+"px",d=l+"px",c=`url(${e}) no-repeat`;if(i.style.width=a,i.style.height=d,setTimeout(()=>{i.style.background=c,o&&(i.style.backgroundSize="100%")},0),n.style.height=d,n.style["border-radius"]=t?l/2+"px 0 0 "+l/2+"px":"0",s.style.height=d,s.style["border-radius"]=t?l/2+"px":"0",i.removeChild(r),l>h.height){var f=(l-h.height)/2;s.style.height=h.height+"px",s.style.overflow="visible",i.style.top=`-${f}px`,n.style.height=h.height+"px",n.style["border-radius"]=t?l/2+"px 0 0 "+l/2+"px":"0"}s.dispatchEvent(L)},r.src=e,i.appendChild(r)}else{var o=h.height/2;s.style.overflow="hidden",s.style["border-radius"]=t?o+"px":"0",n.style["border-radius"]=t?o+"px 0 0 "+o+"px":"0",setTimeout(()=>{s.dispatchEvent(L)},0)}},j=()=>{if(E){let e=[s,f];p=Slydr.create("vertical-marks"),Slydr.wrapAll(e,p)}s.classList.add("vertical")},B=()=>{if(!w&&(S||C||W)&&!h.disabled){let e,t=!1,s=!1,n=!1,i=m?40:37,o=m?38:39;_.docKeyDown=(r=>{t||(window.event?(e=window.event.keyCode,s=window.event.shiftKey,n=window.event.ctrlKey):r&&(e=r.which,s=r.shiftKey,n=r.ctrlKey),(C&&s&&!n||W&&n&&!s||!C&&!W)&&(e===i?(O.eventMouseDown("<"),t=!0):e===o&&(O.eventMouseDown(">"),t=!0)))}),_.docKeyUp=(()=>{t=!1,O.clearAction()}),document.addEventListener("keydown",_.docKeyDown),document.addEventListener("keyup",_.docKeyUp)}};this.ready=(e=>v=e);const K={down:w?"touchstart":"mousedown",move:w?"touchmove":"mousemove",up:w?"touchend":"mouseup"},_={barMouseDown:e=>{if(e.returnValue&&(e.returnValue=!1),d=!0,s.dataset.state="active",!w){const t=s.offsetWidth,o=i.offsetWidth;let r=null;if(m){window.navigator.msPointerEnabled&&null===y?y=s.getBoundingClientRect().top:null!==p&&null===y&&(y=p.offsetTop),r=(null!==y?y:s.offsetTop)+t-(e.pageY-2)}else r=e.pageX-s.offsetLeft;let l=r-o/2;l<0?(l=0,i.style.left="0"):l>=t-o&&(l=t-o,i.style.left=t-o+"px"),i.style.left=l+"px",n.style.width=l+o/2+"px",b&&"hard"!==b||H.init("drag",l),k&&P(this.getPercent(l))}},docMouseMove:e=>{if(d){const l=s.offsetWidth,d=i.offsetWidth;var t=null;if(m){window.navigator.msPointerEnabled&&null===y?y=s.getBoundingClientRect().top:null!==p&&null===y&&(y=p.offsetTop);let n=(null!==y?y:s.offsetTop)+l;w?(touchY=e.targetTouches[0].pageY,t=n-touchY):t=n-e.pageY}else w?(touchX=e.targetTouches[0].pageX,t=touchX-s.offsetLeft):t=e.pageX-s.offsetLeft;const f=d/2,u=t-f;e.returnValue&&(e.returnValue=!1),t<=f&&(!g||"hard"!==b)?(i.style.left="0",n.style.width=f+"px"):t>=l-f&&(!g||"hard"!==b)?(i.style.left=l-d+"px",n.style.width=l-f+"px"):(i.style.left=t-f+"px",n.style.width=t+"px",b&&"hard"!==b||H.init("drag",u)),c=i.offsetLeft;var r=s.dataset.state;o=this.getPercent(c),h.events.onDrag&&"active"===r&&h.events.onDrag.call(a,a.data),k&&"active"===r&&P(o)}},docMouseUp:e=>{if(d=!1,"active"===s.dataset.state){const e=i.offsetLeft;c=!g||"soft"!==b&&"hard"!==b?e<0?0:e:H.init("drop",e),o=this.getPercent(c),h.events.drop&&h.events.drop.call(a,a.data),h.events.drag&&h.events.drag.call(a,a.data),s.dataset.state="inactive",k&&P(o)}O.is_down&&O.clearAction()},winResize:()=>{const e=i.offsetWidth,t=s.offsetWidth;if(a["start-at"]=o,E){let s=null;f.style.width=t+"px",[].slice.call(f.children).forEach((n,i)=>{s=(t-e)/(x-1)*i+e/2,n.style.left=s+"px"})}}},z=()=>{h.disabled||(s.addEventListener(K.down,_.barMouseDown),document.addEventListener(K.move,_.docMouseMove),document.addEventListener(K.up,_.docMouseUp),window.addEventListener("resize",_.winResize))},H={pctValues:[0],storedValue:"s-1",index:null,init:function(e,t){if(g){var o=h.snap.sensitivity;if(o||"hard"===b||"soft"===b){var r=i.offsetWidth,l=s.offsetWidth,a=(o&&o>0&&o<4?5*(o+1):15)-3;let d=[];for(let e of this.pctValues)d.push((l-r)*e/100);let h=null,c=0,f=0;for(let e of d)(null===h||Math.abs(e-t)<Math.abs(h-t))&&(h=e,c=this.pctValues[f],this.index=f),f++;"drag"===e?"hard"===b?(i.style.left=h+"px",n.style.width=h+r/2+"px",this.on(h,c)):Math.round(Math.abs(h-t))<a?(i.style.left=h+"px",n.style.width=h+r/2+"px",this.on(h,c)):this.storedValue="s-1":(i.style.left=h+"px",n.style.width=h+r/2+"px")}}},setValues:function(){for(var e=i.offsetWidth,t=100/(x-1),s=t;s<=101;)this.pctValues.push(s),s+=t;E&&this.drawMarks(e)},drawMarks:e=>{var t=s.offsetWidth;if(s.insertAdjacentHTML("afterend",'<div class="slydr-markers"></div>'),(f=s.parentNode.getElementsByClassName("slydr-markers")[0]).style.width=t+"px",f){let s="",n=null;f.style.width=t+"px";for(let i=x-1;i>=0;i--)s+=`<div style="left:${n=(t-e)/(x-1)*i+e/2}px"></div>`;f.innerHTML=s}},on:function(e){t.events.onSnap&&"s"+e!==this.storedValue&&(this.storedValue="s"+e,o=a.getPercent(e),t.events.onSnap&&t.events.onSnap.call(a,a.data))},pre:function(){switch(b){case"hard":case"soft":this.init("drag",i.offsetLeft),o=a.getPercent(i.offsetLeft)}}},O={draw:function(){if(this.knob_adjust=i.offsetWidth/s.offsetWidth*50,r=Slydr.create("slydr-buttons"),l=Slydr.create("slydr-buttons"),r.innerHTML="&nbsp;+&nbsp;",l.innerHTML="&nbsp;&minus;&nbsp;",l.style["font-size"]=r.style["font-size"]=s.offsetHeight+"px",E){let e=null;if(m)e=s.closest(".vertical-marks");else{let t=[s];u=Slydr.create("button-marks"),E&&t.push(f),u.style.width=s.style.width,e=Slydr.wrapAll(t,u)}e.insertBefore(r,s.nextSibling),e.prepend(l),l.style["margin-left"]="-"+l.offsetWidth+"px"}else s.style.display=m?"block":"inline-block",s.style.verticalAlign="middle",s.parentNode.insertBefore(r,s.nextSibling),s.parentNode.insertBefore(l,s);h.disabled||(r.addEventListener(K.down,()=>this.eventMouseDown(">")),r.addEventListener(K.up,this.clearAction),l.addEventListener(K.down,()=>this.eventMouseDown("<")),l.addEventListener(K.up,this.clearAction))},triggers:function(e,r){if(this.snap){if(null===H.index)for(let t=0;t<H.pctValues.length;t++)if(H.pctValues[t]>=o){H.index=">"===e?t-1:t;break}">"===e?x-1>H.index&&H.index++:H.index>0&&H.index--,o=H.pctValues[H.index]}else">"===e?o+=r?1:10:o-=r?1:10;var l=o;o+this.knob_adjust>100?(o=100,l=100):o-this.knob_adjust<0&&(o=0,l=0);var d=(s.offsetWidth-i.offsetWidth)*l/100+i.offsetWidth/2,h=d-i.offsetWidth/2;i.style.left=h+"px",n.style.width=d+"px",k&&P(l),o=a.getPercent(h),t.events.onBtnClick&&t.events.onBtnClick.call(a,a.data)},hold:function(e){var t=setInterval(()=>{this.is_down?this.triggers(e,!0):clearInterval(t)},this.snap?101:10)},clearAction:function(){this.is_down=!1,clearTimeout(this.timers)},eventMouseDown:function(e){this.is_down=!0,this.triggers(e),this.timers=setTimeout(()=>this.hold(e),500)},knob_adjust:0,is_down:!1,timers:null,snap:g&&("hard"===b||"soft"===b)};this.destroy=(e=>{if(p){const e=p.parentNode;e.insertBefore(s,p.nextSibling),e.removeChild(p)}const t=s.parentNode.querySelector(".slydr-markers");if(t&&t.parentNode.removeChild(t),w?document.removeEventListener(K.down,eventDocumentMouseDown):(S||C||W)&&(document.removeEventListener("keydown",_.docKeyDown),document.removeEventListener("keyup",_.docKeyUp)),h.buttons){const e=r.parentNode;if(e.removeChild(r),e.removeChild(l),r=l=null,!p&&u){const e=u.parentNode;e.insertBefore(u.childNodes[0],u.nextSibling),e.removeChild(u)}}if(document.removeEventListener(K.move,_.docMouseMove),document.removeEventListener(K.up,_.docMouseUp),window.removeEventListener("resize",_.winResize),s.removeEventListener(K.down,_.barMouseDown),s.removeChild(i),s.removeChild(n),s.removeAttribute("style"),s.removeAttribute("data-state"),s.classList.remove("vertical"),!e){for(let e in this)delete this[e];Slydr.entries.forEach((e,t)=>{e===this&&Slydr.entries.splice(t,1)})}}),this.reset=(()=>V(!0)),V()}getPercent(e){var t=e/(this.frameElement.offsetWidth-this.knob.offsetWidth)*100;return Math.min(t,100)}set position(e){const t=this.frameElement.offsetWidth,s=this.knob.offsetWidth;e<=0?e=0:e>=100&&(e=100);const n=(t-s)*e/100+s/2,i=n-s/2;this.knob.style.left=i+"px",this.trak.style.width=n+"px",this.is.colorShift&&(this.trak.children[0].style.opacity=e/100)}static wrapAll(e,t){e[0].parentNode.insertBefore(t,e[0]);for(let s of e)t.appendChild(s);return t}static create(e,t){var s=document.createElement("div");return s.className=e,t&&t.appendChild(s),s}}Slydr.entries=[];